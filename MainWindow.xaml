<Window x:Class="ManutMap.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
        mc:Ignorable="d"
        Title="ManutMap – Mapa de Manutenções"
        Height="768" Width="1366"
        Background="#F0F2F5"
        WindowStartupLocation="CenterScreen">

    <Window.Resources>
        <SolidColorBrush x:Key="PrimaryBlueBrush" Color="#0078D4"/>
        <SolidColorBrush x:Key="PrimaryBlueHoverBrush" Color="#005A9E"/>
        <SolidColorBrush x:Key="PrimaryTextBrush" Color="#1F1F1F"/>
        <SolidColorBrush x:Key="SecondaryTextBrush" Color="#605E5C"/>
        <SolidColorBrush x:Key="BorderBrush" Color="#D1D1D1"/>
        <SolidColorBrush x:Key="PanelBackgroundBrush" Color="White"/>
        <SolidColorBrush x:Key="ControlBackgroundHover" Color="#F3F2F1"/>

        <Thickness x:Key="HeaderMargin">20</Thickness>
        <Thickness x:Key="PanelPadding">20,0</Thickness>
        <Thickness x:Key="ControlMargin">0,15,0,0</Thickness>
        <Thickness x:Key="LabelMargin">0,0,0,5</Thickness>

        <Style TargetType="TextBlock">
            <Setter Property="Foreground" Value="{StaticResource PrimaryTextBrush}"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <Style x:Key="LabelTextBlock" TargetType="TextBlock">
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="{StaticResource LabelMargin}"/>
            <Setter Property="Foreground" Value="{StaticResource SecondaryTextBrush}"/>
        </Style>

        <Style TargetType="TextBox">
            <Setter Property="Padding" Value="8,5"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border CornerRadius="4" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Background="{TemplateBinding Background}">
                            <ScrollViewer x:Name="PART_ContentHost"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="ComboBox">
            <Setter Property="Padding" Value="8,5"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
        </Style>

        <Style TargetType="DatePicker">
            <Setter Property="Padding" Value="8,5"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
        </Style>

        <Style x:Key="PrimaryButton" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource PrimaryBlueBrush}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" CornerRadius="4" Background="{TemplateBinding Background}" SnapsToDevicePixels="True">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource PrimaryBlueHoverBrush}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.6"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="Expander">
            <Setter Property="Padding" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Expander">
                        <StackPanel>
                            <ToggleButton x:Name="HeaderSite"
                                          IsChecked="{Binding IsExpanded, RelativeSource={RelativeSource TemplatedParent}}"
                                          OverridesDefaultStyle="True">
                                <ToggleButton.Template>
                                    <ControlTemplate TargetType="ToggleButton">
                                        <Border Padding="0,5" Background="Transparent">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                <Path x:Name="Arrow"
                                                      Grid.Column="0"
                                                      SnapsToDevicePixels="True"
                                                      Fill="{StaticResource SecondaryTextBrush}"
                                                      Data="M 0 0 L 4 4 L 8 0 Z"
                                                      VerticalAlignment="Center"
                                                      Margin="0,0,8,0"/>
                                                <ContentPresenter Grid.Column="1"
                                                                  ContentSource="Content"
                                                                  RecognizesAccessKey="True"/>
                                            </Grid>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsChecked" Value="True">
                                                <Setter TargetName="Arrow" Property="Data" Value="M 0 4 L 4 0 L 8 4 Z"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </ToggleButton.Template>
                                <TextBlock Text="{TemplateBinding Header}" FontWeight="Bold" FontSize="16"/>
                            </ToggleButton>
                            <ContentPresenter x:Name="ExpandSite" Visibility="Collapsed" Margin="5,10,5,10"/>
                        </StackPanel>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsExpanded" Value="True">
                                <Setter TargetName="ExpandSite" Property="Visibility" Value="Visible"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="GroupBox">
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="0,8,0,12"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="GroupBox">
                        <StackPanel Margin="{StaticResource ControlMargin}">
                            <TextBlock Text="{TemplateBinding Header}" FontWeight="Bold" FontSize="14" Foreground="{StaticResource PrimaryTextBrush}" Margin="0,0,0,8"/>
                            <ContentPresenter Margin="10,5,0,0"/>
                            <Separator Margin="0,15,0,0" />
                        </StackPanel>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="SidebarToggleButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource SecondaryTextBrush}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Width" Value="22"/>
            <Setter Property="Height" Value="50"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}" CornerRadius="4" SnapsToDevicePixels="True">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{StaticResource ControlBackgroundHover}"/>
                                <Setter Property="Foreground" Value="{StaticResource PrimaryBlueBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition x:Name="SidebarColumn" Width="340"/>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <Border Grid.Column="0" x:Name="SidebarBorder" Background="{StaticResource PanelBackgroundBrush}" BorderThickness="0,0,1,0" BorderBrush="{StaticResource BorderBrush}">
            <DockPanel>
                <StackPanel DockPanel.Dock="Top" Margin="{StaticResource HeaderMargin}">
                    <TextBlock Text="ManutMap" FontSize="24" FontWeight="Bold"/>
                    <TextBlock Text="Filtros e Visualização" FontSize="14" Foreground="{StaticResource SecondaryTextBrush}" Margin="0,4,0,0"/>
                </StackPanel>

                <Grid DockPanel.Dock="Bottom" Margin="{StaticResource HeaderMargin}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Button x:Name="DownloadButton" Grid.Column="0" Content="Baixar JSON" Style="{StaticResource PrimaryButton}" Click="DownloadButton_Click" Margin="0,0,5,0"/>
                    <Button x:Name="ShareButton" Grid.Column="1" Content="Compartilhar" Style="{StaticResource PrimaryButton}" Click="ShareButton_Click" Margin="5,0,0,0"/>
                </Grid>

                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="{StaticResource PanelPadding}">
                    <StackPanel>
                        <Expander Header="Busca por Atributos" IsExpanded="True">
                            <StackPanel>
                                <TextBlock Text="Tipo SIGFI" Style="{StaticResource LabelTextBlock}"/>
                                <ComboBox x:Name="SigfiFilterCombo" SelectionChanged="FiltersChanged"/>
                                <TextBlock Text="Tipo Serviço" Style="{StaticResource LabelTextBlock}" Margin="{StaticResource ControlMargin}"/>
                                <ComboBox x:Name="TipoFilterCombo" SelectionChanged="FiltersChanged"/>
                                <TextBlock Text="Número da OS" Style="{StaticResource LabelTextBlock}" Margin="{StaticResource ControlMargin}"/>
                                <TextBox x:Name="NumOsFilterBox" TextChanged="FiltersChanged"/>
                                <TextBlock Text="ID SIGFI" Style="{StaticResource LabelTextBlock}" Margin="{StaticResource ControlMargin}"/>
                                <TextBox x:Name="IdSigfiFilterBox" TextChanged="FiltersChanged"/>
                                <TextBlock Text="Regional" Style="{StaticResource LabelTextBlock}" Margin="{StaticResource ControlMargin}"/>
                                <ComboBox x:Name="RegionalFilterCombo" SelectionChanged="RegionalChanged"/>
                                <TextBlock Text="Rota" Style="{StaticResource LabelTextBlock}" Margin="{StaticResource ControlMargin}"/>
                                <ComboBox x:Name="RotaFilterCombo" SelectionChanged="FiltersChanged"/>
                            </StackPanel>
                        </Expander>

                        <Expander Header="Período de Execução" IsExpanded="True" Margin="{StaticResource ControlMargin}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel>
                                    <TextBlock Text="Data Inicial" Style="{StaticResource LabelTextBlock}"/>
                                    <DatePicker x:Name="StartDatePicker" SelectedDateChanged="FiltersChanged"/>
                                </StackPanel>
                                <TextBlock Grid.Column="1" Text="a" Margin="10,0" VerticalAlignment="Bottom" Padding="0,0,0,8"/>
                                <StackPanel Grid.Column="2">
                                    <TextBlock Text="Data Final" Style="{StaticResource LabelTextBlock}"/>
                                    <DatePicker x:Name="EndDatePicker" SelectedDateChanged="FiltersChanged"/>
                                </StackPanel>
                            </Grid>
                        </Expander>

                        <Expander Header="Visualização e Camadas" IsExpanded="True" Margin="{StaticResource ControlMargin}">
                            <StackPanel>
                                <GroupBox Header="Status das OS">
                                    <StackPanel>
                                        <CheckBox x:Name="ChbOpen" Content="Exibir OS Abertas" IsChecked="True" Checked="FiltersChanged" Unchecked="FiltersChanged"/>
                                        <TextBlock Text="Cor (Aberto):" Style="{StaticResource LabelTextBlock}" Margin="10,5,0,2"/>
                                        <ComboBox x:Name="ColorOpenCombo" SelectionChanged="FiltersChanged" Width="120" Margin="10,0,0,10">
                                            <ComboBoxItem Content="Vermelho" Tag="#FF0000" IsSelected="True"/>
                                            <ComboBoxItem Content="Verde" Tag="#008000"/>
                                            <ComboBoxItem Content="Azul" Tag="#0000FF"/>
                                            <ComboBoxItem Content="Laranja" Tag="#FFA500"/>
                                            <ComboBoxItem Content="Amarelo" Tag="#FFFF00"/>
                                            <ComboBoxItem Content="Roxo" Tag="#800080"/>
                                            <ComboBoxItem Content="Preto" Tag="#000000"/>
                                            <ComboBoxItem Content="Cinza" Tag="#808080"/>
                                        </ComboBox>
                                        <CheckBox x:Name="ChbClosed" Content="Exibir OS Concluídas" IsChecked="True" Checked="FiltersChanged" Unchecked="FiltersChanged"/>
                                        <TextBlock Text="Cor (Concluído):" Style="{StaticResource LabelTextBlock}" Margin="10,5,0,2"/>
                                        <ComboBox x:Name="ColorClosedCombo" SelectionChanged="FiltersChanged" Width="120" Margin="10,0,0,0">
                                            <ComboBoxItem Content="Verde" Tag="#008000" IsSelected="True"/>
                                            <ComboBoxItem Content="Vermelho" Tag="#FF0000"/>
                                            <ComboBoxItem Content="Azul" Tag="#0000FF"/>
                                            <ComboBoxItem Content="Laranja" Tag="#FFA500"/>
                                            <ComboBoxItem Content="Amarelo" Tag="#FFFF00"/>
                                            <ComboBoxItem Content="Roxo" Tag="#800080"/>
                                            <ComboBoxItem Content="Preto" Tag="#000000"/>
                                            <ComboBoxItem Content="Cinza" Tag="#808080"/>
                                        </ComboBox>
                                    </StackPanel>
                                </GroupBox>

                                <GroupBox Header="Colorir por Tipo SIGFI">
                                    <StackPanel>
                                        <CheckBox x:Name="ChbColorBySigfi" Content="Ativar Coloração por Tipo SIGFI" Checked="FiltersChanged" Unchecked="FiltersChanged"/>
                                        <TextBlock Text="Cor Preventiva:" Style="{StaticResource LabelTextBlock}" Margin="10,5,0,2"/>
                                        <ComboBox x:Name="ColorPrevCombo" SelectionChanged="FiltersChanged" Width="120" Margin="10,0,0,5">
                                            <ComboBoxItem Content="Azul" Tag="#0000FF" IsSelected="True"/>
                                            <ComboBoxItem Content="Vermelho" Tag="#FF0000"/>
                                            <ComboBoxItem Content="Verde" Tag="#008000"/>
                                            <ComboBoxItem Content="Laranja" Tag="#FFA500"/>
                                            <ComboBoxItem Content="Amarelo" Tag="#FFFF00"/>
                                            <ComboBoxItem Content="Roxo" Tag="#800080"/>
                                            <ComboBoxItem Content="Preto" Tag="#000000"/>
                                            <ComboBoxItem Content="Cinza" Tag="#808080"/>
                                        </ComboBox>

                                        <TextBlock Text="Cor Corretiva:" Style="{StaticResource LabelTextBlock}" Margin="10,5,0,2"/>
                                        <ComboBox x:Name="ColorCorrCombo" SelectionChanged="FiltersChanged" Width="120" Margin="10,0,0,0">
                                            <ComboBoxItem Content="Laranja" Tag="#FFA500" IsSelected="True"/>
                                            <ComboBoxItem Content="Vermelho" Tag="#FF0000"/>
                                            <ComboBoxItem Content="Verde" Tag="#008000"/>
                                            <ComboBoxItem Content="Azul" Tag="#0000FF"/>
                                            <ComboBoxItem Content="Amarelo" Tag="#FFFF00"/>
                                            <ComboBoxItem Content="Roxo" Tag="#800080"/>
                                            <ComboBoxItem Content="Preto" Tag="#000000"/>
                                            <ComboBoxItem Content="Cinza" Tag="#808080"/>
                                        </ComboBox>
                                    </StackPanel>
                                </GroupBox>

                                <GroupBox Header="Colorir por Tipo de Serviço">
                                    <StackPanel>
                                        <CheckBox x:Name="ChbColorByTipo" Content="Ativar Coloração por Serviço" Checked="FiltersChanged" Unchecked="FiltersChanged"/>
                                        <TextBlock Text="Cor Preventiva:" Style="{StaticResource LabelTextBlock}" Margin="10,5,0,2"/>
                                        <ComboBox x:Name="ColorTipoPrevCombo" SelectionChanged="FiltersChanged" Width="120" Margin="10,0,0,5">
                                            <ComboBoxItem Content="Azul" Tag="#0000FF" IsSelected="True"/>
                                            <ComboBoxItem Content="Vermelho" Tag="#FF0000"/>
                                            <ComboBoxItem Content="Verde" Tag="#008000"/>
                                            <ComboBoxItem Content="Laranja" Tag="#FFA500"/>
                                            <ComboBoxItem Content="Amarelo" Tag="#FFFF00"/>
                                            <ComboBoxItem Content="Roxo" Tag="#800080"/>
                                            <ComboBoxItem Content="Preto" Tag="#000000"/>
                                            <ComboBoxItem Content="Cinza" Tag="#808080"/>
                                        </ComboBox>

                                        <TextBlock Text="Cor Corretiva:" Style="{StaticResource LabelTextBlock}" Margin="10,5,0,2"/>
                                        <ComboBox x:Name="ColorTipoCorrCombo" SelectionChanged="FiltersChanged" Width="120" Margin="10,0,0,5">
                                            <ComboBoxItem Content="Laranja" Tag="#FFA500" IsSelected="True"/>
                                            <ComboBoxItem Content="Vermelho" Tag="#FF0000"/>
                                            <ComboBoxItem Content="Verde" Tag="#008000"/>
                                            <ComboBoxItem Content="Azul" Tag="#0000FF"/>
                                            <ComboBoxItem Content="Amarelo" Tag="#FFFF00"/>
                                            <ComboBoxItem Content="Roxo" Tag="#800080"/>
                                            <ComboBoxItem Content="Preto" Tag="#000000"/>
                                            <ComboBoxItem Content="Cinza" Tag="#808080"/>
                                        </ComboBox>

                                        <TextBlock Text="Cor Serviços:" Style="{StaticResource LabelTextBlock}" Margin="10,5,0,2"/>
                                        <ComboBox x:Name="ColorTipoServCombo" SelectionChanged="FiltersChanged" Width="120" Margin="10,0,0,0">
                                            <ComboBoxItem Content="Teal" Tag="#008080" IsSelected="True"/>
                                            <ComboBoxItem Content="Vermelho" Tag="#FF0000"/>
                                            <ComboBoxItem Content="Verde" Tag="#008000"/>
                                            <ComboBoxItem Content="Azul" Tag="#0000FF"/>
                                            <ComboBoxItem Content="Laranja" Tag="#FFA500"/>
                                            <ComboBoxItem Content="Amarelo" Tag="#FFFF00"/>
                                            <ComboBoxItem Content="Roxo" Tag="#800080"/>
                                            <ComboBoxItem Content="Preto" Tag="#000000"/>
                                            <ComboBoxItem Content="Cinza" Tag="#808080"/>
                                        </ComboBox>
                                    </StackPanel>
                                </GroupBox>

                                <GroupBox Header="Campo de Coordenadas">
                                    <StackPanel>
                                        <TextBlock Text="Selecione o campo com coordenadas:" Style="{StaticResource LabelTextBlock}"/>
                                        <ComboBox x:Name="LatLonFieldCombo" SelectionChanged="FiltersChanged" Width="150" Margin="0,5,0,0">
                                            <ComboBoxItem Content="LATLON" IsSelected="True"/>
                                            <ComboBoxItem Content="LATLONCON"/>
                                        </ComboBox>
                                    </StackPanel>
                                </GroupBox>
                            </StackPanel>
                        </Expander>
                    </StackPanel>
                </ScrollViewer>
            </DockPanel>
        </Border>

        <Button Grid.Column="1"
                x:Name="ToggleSidebarButton"
                Click="ToggleSidebarButton_Click"
                Style="{StaticResource SidebarToggleButtonStyle}"
                ToolTip="Recolher/Expandir Painel">
            ◄
        </Button>

        <Grid Grid.Column="2">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <wv2:WebView2 Grid.Row="0" x:Name="MapView"/>

            <Border Grid.Row="1" Background="{StaticResource PanelBackgroundBrush}" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,1,0,0" Padding="15,10">
                <WrapPanel Orientation="Horizontal" ItemHeight="20">
                    <StackPanel Orientation="Horizontal" Margin="0,0,20,0">
                        <TextBlock Text="Preventivas:" FontWeight="Bold" Margin="0,0,8,0"/>
                        <TextBlock x:Name="PreventivasStatsText" Text="0 abertas, 0 concluídas"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,20,0">
                        <TextBlock Text="Corretivas:" FontWeight="Bold" Margin="0,0,8,0"/>
                        <TextBlock x:Name="CorretivasStatsText" Text="0 abertas, 0 concluídas"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,20,0">
                        <TextBlock Text="Serviços:" FontWeight="Bold" Margin="0,0,8,0"/>
                        <TextBlock x:Name="ServicosStatsText" Text="0 abertos, 0 concluídos"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,20,0">
                        <TextBlock Text="Total Exibido:" FontWeight="Bold" Margin="0,0,8,0"/>
                        <TextBlock x:Name="TotalStatsText" Text="0"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Atualizado:" FontWeight="Bold" Margin="0,0,8,0"/>
                        <TextBlock x:Name="LastUpdatedText" Text="--"/>
                    </StackPanel>
                </WrapPanel>
            </Border>
        </Grid>
    </Grid>
</Window>