<Window x:Class="ManutMap.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
        mc:Ignorable="d"
        Title="ManutMap – Mapa de Manutenções"
        Height="768" Width="1366"
        Background="#F0F2F5"
        WindowStartupLocation="CenterScreen">

    <Window.Resources>
        <SolidColorBrush x:Key="PrimaryBlueBrush" Color="#0078D4"/>
        <SolidColorBrush x:Key="PrimaryTextBrush" Color="#1F1F1F"/>
        <SolidColorBrush x:Key="SecondaryTextBrush" Color="#605E5C"/>
        <SolidColorBrush x:Key="BorderBrush" Color="#D1D1D1"/>
        <SolidColorBrush x:Key="PanelBackgroundBrush" Color="White"/>

        <Style TargetType="TextBlock">
            <Setter Property="Foreground" Value="{StaticResource PrimaryTextBrush}"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <Style x:Key="LabelTextBlock" TargetType="TextBlock">
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="0,0,0,5"/>
            <Setter Property="Foreground" Value="{StaticResource SecondaryTextBrush}"/>
        </Style>

        <Style TargetType="TextBox">
            <Setter Property="Padding" Value="8,5"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border CornerRadius="4" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Background="{TemplateBinding Background}">
                            <ScrollViewer x:Name="PART_ContentHost"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="ComboBox" BasedOn="{StaticResource {x:Type ComboBox}}">
            <Setter Property="Padding" Value="8,5"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
        </Style>

        <Style x:Key="PrimaryButton" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource PrimaryBlueBrush}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" CornerRadius="4" Background="{TemplateBinding Background}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#005A9E"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="Expander">
            <Setter Property="Margin" Value="0,0,0,10"/>
            <Setter Property="HeaderTemplate">
                <Setter.Value>
                    <DataTemplate>
                        <TextBlock Text="{Binding}" FontWeight="Bold" FontSize="16" Margin="0,5"/>
                    </DataTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="340"/>
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <Border Grid.Column="0" Background="{StaticResource PanelBackgroundBrush}" BorderThickness="0,0,1,0" BorderBrush="{StaticResource BorderBrush}">
            <DockPanel>
                <TextBlock DockPanel.Dock="Top" Text="ManutMap" FontSize="24" FontWeight="Bold" Margin="20,20,20,10"/>
                <TextBlock DockPanel.Dock="Top" Text="Filtros e Visualização" FontSize="14" Foreground="{StaticResource SecondaryTextBrush}" Margin="20,0,20,20"/>

                <Grid DockPanel.Dock="Bottom" Margin="20">
                    <Button x:Name="DownloadButton" Content="Baixar JSON" Style="{StaticResource PrimaryButton}" Click="DownloadButton_Click" Margin="0,0,0,-6"/>
                </Grid>

                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="20,0">
                    <StackPanel>
                        <Expander Header="Busca por Atributos" IsExpanded="True">
                            <StackPanel Margin="5,10,5,0">
                                <TextBlock Text="Tipo SIGFI" Style="{StaticResource LabelTextBlock}"/>
                                <ComboBox x:Name="SigfiFilterCombo" SelectionChanged="FiltersChanged"/>

                                <TextBlock Text="Tipo Serviço" Style="{StaticResource LabelTextBlock}" Margin="0,10,0,5"/>
                                <ComboBox x:Name="TipoFilterCombo" SelectionChanged="FiltersChanged"/>

                                <TextBlock Text="Número da OS" Style="{StaticResource LabelTextBlock}" Margin="0,10,0,5"/>
                                <TextBox x:Name="NumOsFilterBox" TextChanged="FiltersChanged"/>

                                <TextBlock Text="ID SIGFI" Style="{StaticResource LabelTextBlock}" Margin="0,10,0,5"/>
                                <TextBox x:Name="IdSigfiFilterBox" TextChanged="FiltersChanged"/>

                                <TextBlock Text="Regional" Style="{StaticResource LabelTextBlock}" Margin="0,10,0,5"/>
                                <ComboBox x:Name="RegionalFilterCombo" SelectionChanged="RegionalChanged"/>

                                <TextBlock Text="Rota" Style="{StaticResource LabelTextBlock}" Margin="0,10,0,5"/>
                                <ComboBox x:Name="RotaFilterCombo" SelectionChanged="FiltersChanged"/>
                            </StackPanel>
                        </Expander>

                        <Expander Header="Período de Execução" IsExpanded="True">
                            <Grid Margin="5,10,5,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel>
                                    <TextBlock Text="Data Inicial" Style="{StaticResource LabelTextBlock}"/>
                                    <DatePicker x:Name="StartDatePicker" SelectedDateChanged="FiltersChanged"/>
                                </StackPanel>
                                <TextBlock Grid.Column="1" Text="a" Margin="10,0" VerticalAlignment="Bottom" Padding="0,0,0,8"/>
                                <StackPanel Grid.Column="2">
                                    <TextBlock Text="Data Final" Style="{StaticResource LabelTextBlock}"/>
                                    <DatePicker x:Name="EndDatePicker" SelectedDateChanged="FiltersChanged"/>
                                </StackPanel>
                            </Grid>
                        </Expander>

                        <Expander Header="Visualização e Camadas" IsExpanded="True">
                            <StackPanel Margin="5,10,5,0" Orientation="Vertical">

                                <GroupBox Header="Status das OS">
                                    <StackPanel Margin="10,5,0,0">
                                        <CheckBox x:Name="ChbOpen" Content="Exibir OS Abertas" IsChecked="True" Checked="FiltersChanged" Unchecked="FiltersChanged"/>
                                        <TextBlock Text="Cor (Aberto):" Style="{StaticResource LabelTextBlock}" Margin="10,5,0,2"/>
                                        <TextBox x:Name="TxtColorOpen" Width="100" Margin="10,0,0,10" Text="#FF0000"/>

                                        <CheckBox x:Name="ChbClosed" Content="Exibir OS Concluídas" IsChecked="True" Checked="FiltersChanged" Unchecked="FiltersChanged"/>
                                        <TextBlock Text="Cor (Concluído):" Style="{StaticResource LabelTextBlock}" Margin="10,5,0,2"/>
                                        <TextBox x:Name="TxtColorClosed" Width="100" Margin="10,0,0,0" Text="#008000"/>
                                    </StackPanel>
                                </GroupBox>

                                <GroupBox Header="Colorir por Tipo SIGFI">
                                    <StackPanel Margin="10,5,0,0">
                                        <CheckBox x:Name="ChbColorBySigfi" Content="Ativar Coloração por Tipo SIGFI" Checked="FiltersChanged" Unchecked="FiltersChanged"/>
                                        <TextBlock Text="Cor Preventiva:" Style="{StaticResource LabelTextBlock}" Margin="10,5,0,2"/>
                                        <TextBox x:Name="TxtColorPrev" Width="100" Margin="10,0,0,5" Text="#0000FF"/>

                                        <TextBlock Text="Cor Corretiva:" Style="{StaticResource LabelTextBlock}" Margin="10,5,0,2"/>
                                        <TextBox x:Name="TxtColorCorr" Width="100" Margin="10,0,0,0" Text="#FFA500"/>
                                    </StackPanel>
                                </GroupBox>

                                <GroupBox Header="Campo de Coordenadas">
                                    <StackPanel Margin="10,5,0,0">
                                        <TextBlock Text="Selecione o campo com coordenadas:" Style="{StaticResource LabelTextBlock}"/>
                                        <ComboBox x:Name="LatLonFieldCombo" SelectionChanged="FiltersChanged" Width="150" Margin="0,5,0,0">
                                            <ComboBoxItem Content="LATLON"/>
                                            <ComboBoxItem Content="LATLONCON"/>
                                        </ComboBox>
                                    </StackPanel>
                                </GroupBox>

                            </StackPanel>
                        </Expander>
                    </StackPanel>
                </ScrollViewer>
            </DockPanel>
        </Border>

        <Grid Grid.Column="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <wv2:WebView2 x:Name="MapView" Grid.Row="0" />

            <Border Grid.Row="1" 
                    Background="{StaticResource PanelBackgroundBrush}" 
                    BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="0 1 0 0"
                    Padding="15,10">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0" Text="Preventivas:" FontWeight="Bold" Margin="0,0,8,0" />
                    <TextBlock Grid.Column="1" x:Name="PreventivasStatsText" Text="0 abertas, 0 concluídas" />

                    <TextBlock Grid.Column="2" Text="Corretivas:" FontWeight="Bold" Margin="15,0,8,0" />
                    <TextBlock Grid.Column="3" x:Name="CorretivasStatsText" Text="0 abertas, 0 concluídas" />

                    <TextBlock Grid.Column="4" Text="Serviços:" FontWeight="Bold" Margin="15,0,8,0" />
                    <TextBlock Grid.Column="5" x:Name="ServicosStatsText" Text="0 abertos, 0 concluídos" />

                    <TextBlock Grid.Column="6" Text="Total Exibido:" FontWeight="Bold" Margin="15,0,8,0" />
                    <TextBlock Grid.Column="7" x:Name="TotalStatsText" Text="0" />
                    <TextBlock Grid.Column="8" Text="Atualizado:" FontWeight="Bold" Margin="15,0,8,0" />
                    <TextBlock Grid.Column="9" x:Name="LastUpdatedText" Text="-" />
                </Grid>
            </Border>
        </Grid>
    </Grid>
</Window>